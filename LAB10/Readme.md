# Лабораторная работа №10. Конфигурация безопасности коммутатора

![](https://github.com/IvShikov/OtusLab/blob/main/LAB10/Lab10_Topology.JPG)

![](https://github.com/IvShikov/OtusLab/blob/main/LAB10/Lab10_Addressing_table.JPG)

# Цели:
## Часть 1. Настройка основного сетевого устройства
 - Создание сети.
 - Настройка маршрутизатора R1.
 - Настройка и проверка основных параметров коммутатора.
## Часть 2. Настройка и проверка двух серверов DHCPv4 на R1
 - Конфигурирование VLAN 10.
 - Конфигурирование SVI для VLAN 10.
 - Настройка VLAN 333 с именем Native на S1 и S2.
 - Настройка VLAN 999 с именем ParkingLot на S1 и S2.
## Часть 3. Настройка и проверка DHCP-ретрансляции на R2
 - Реализация магистральных соединений 802.1Q.
 - Настройка портов доступа.
 - Безопасность неиспользуемых портов коммутатора.
 - Документирование и реализация функций безопасности порта.
 - Реализация безопасности DHCP snooping.
 - Реализация PortFast и BPDU Guard.
 - Проверка сквозной связанности.
###
# Общие сведения и сценарий:
Это комплексная лабораторная работа, нацеленная на повторение ранее изученных функций безопасности уровня 2.

**Примечание:** Маршрутизаторы, используемые в практических лабораторных работах CCNA, - это Cisco 4221 с Cisco IOS XE Release 16.9.3 (образ universalk9). В лабораторных работах используются
коммутаторы Cisco Catalyst 2960 с Cisco IOS версии 15.0(2) (образ lanbasek9). Можно использовать другие маршрутизаторы, коммутаторы и версии Cisco IOS. В зависимости от модели устройства и
версии Cisco IOS доступные команды и результаты их выполнения могут отличаться от тех, которые показаны в лабораторных работах. Правильные идентификаторы интерфейса см. в сводной таблице
по интерфейсам маршрутизаторов в конце лабораторной работы.

**Примечание:** Следует убедиться, что все настройки коммутатора удалены и загрузочная конфигурация отсутствует. 
# Необходимые ресурсы:
 - 1 маршрутизатор (Cisco 4221 с универсальным образом Cisco IOS XE версии 16.9.4 или аналогичным);
 - 2 коммутатора (Cisco 2960 с образом lanbasek9 Cisco IOS версии 15.2 (2) или аналогичным) - опционально;
 - 2 ПК (ОС Windows с программой эмуляции терминалов, такой как Cisco Packet Tracer);
 - Консольные кабели для настройки устройств Cisco IOS через консольные порты;
 - Кабели Ethernet, расположенные в соответствии с топологией.
##
## Часть 1. Настройка основного сетевого устройства
##
### Шаг 1. Создание сети.
 - Создали сеть согласно топологии.
 - Выполнили инициализацию устройств.
### Шаг 2. Настройка маршрутизатора R1.
 - Загрузили следующий конфигурационный скрипт на R1.

![](https://github.com/IvShikov/OtusLab/blob/main/LAB10/Lab10_P1S2.JPG)
  
 - Проверили текущую конфигурацию на R1, используя следующую команду **R1# show ip interface brief**
 - Убедились, что IP-адресация и интерфейсы находятся в состоянии up / up.

![](https://github.com/IvShikov/OtusLab/blob/main/LAB10/Lab10_P1S2bс.JPG)

### Шаг 3 Настройка и проверка основных параметров коммутатора
 - Настроили имя хоста для коммутаторов S1 и S2.
 - Запретили нежелательный поиск в DNS.
 - Настроили описания интерфейса для портов, которые используются в S1 и S2.
 - Установили для шлюза по умолчанию для VLAN управления значение 192.168.10.1 на обоих коммутаторах.

![](https://github.com/IvShikov/OtusLab/blob/main/LAB10/Lab10_P1S3.JPG)

##
## Часть 2. Настройка и проверка двух серверов DHCPv4 на R1
##
### Шаг 1. Конфигурирование VLAN 10
Добавили VLAN 10 на S1 и S2 и назвали VLAN - **Management**.
### Шаг 2. Конфигурирование SVI для VLAN 10
Настроили IP-адрес в соответствии с таблицей адресации для SVI для VLAN 10 на S1 и S2. Включили интерфейсы SVI и предоставили описание для интерфейса.
### Шаг 3. Настройка VLAN 333 с именем Native на S1 и S2.
### Шаг 4. Настройка VLAN 999 с именем ParkingLot на S1 и S2.

![](https://github.com/IvShikov/OtusLab/blob/main/LAB10/Lab10_P2.JPG)

##
## Часть 3. Настройка безопасности коммутатора
##
### Шаг 1. Релизация магистральных соединений 802.1Q.
 - Настроили все магистральные порты Fa0/1 на обоих коммутаторах для использования VLAN 333 в качестве native VLAN.
 - Убедились, что режим транкинга успешно настроен на всех коммутаторах.

![](https://github.com/IvShikov/OtusLab/blob/main/LAB10/Lab10_P3S1ab.JPG)

 - Отключили согласование DTP F0/1 на S1 и S2.
 - Проверили с помощью команды **show interfaces**.

![](https://github.com/IvShikov/OtusLab/blob/main/LAB10/Lab10_P3S1cd.JPG)

### Шаг 2. Настройка портов доступа.
 - На S1 настроили F0/5 и F0/6 в качестве портов доступа и связали их с VLAN 10.
 - На S2 настроили порт доступа Fa0/18 и связали его с VLAN 10.

![](https://github.com/IvShikov/OtusLab/blob/main/LAB10/Lab10_P3S2.JPG)

### Шаг 3. Безопасность неиспользуемых портов коммутатора.
 - На S1 и S2 переместили неиспользуемые порты из VLAN 1 в VLAN 999 и отключили неиспользуемые порты.

![](https://github.com/IvShikov/OtusLab/blob/main/LAB10/Lab10_З3S3a_S1.JPG)

![](https://github.com/IvShikov/OtusLab/blob/main/LAB10/Lab10_P3S3a_S2.JPG)

 - Убедились, что неиспользуемые порты отключены и связаны с VLAN 999, введя команду **show interfaces status**.

![](https://github.com/IvShikov/OtusLab/blob/main/LAB10/Lab10_P3S3b_S1.JPG)

![](https://github.com/IvShikov/OtusLab/blob/main/LAB10/Lab10_P3S3b_S2.JPG)

### Шаг 4. Документирование и реализация функций безопасности порта.
Интерфейсы F0/6 на S1 и F0/18 на S2 настроены как порты доступа. На этом шаге мы также настроим безопасность портов на этих двух портах доступа.
 - На S1 ввели команду **show port-security interface f0/6** для отображения настроек по умолчанию безопасности порта для интерфейса F0/6. Ответы представлены ниже.

![](https://github.com/IvShikov/OtusLab/blob/main/LAB10/Lab10_P3S4a_table.JPG)

 - На S1 включили защиту порта на F0/6 со следующими настройками:

Максимальное количество записей MAC-адресов: 3

Режим безопасности: restrict

Aging time: 60 мин.

Aging type: неактивный

 - Проверили безопасность порта на S1 F0/6.

![](https://github.com/IvShikov/OtusLab/blob/main/LAB10/Lab10_P3S4bc.JPG)

 - Включили безопасность порта для F0/18 на S2. Настроили каждый активный порт доступа таким образом, чтобы он автоматически добавлял адреса МАС, изученные на этом порту, в текущую
конфигурацию.

 - Настроили следующие параметры безопасности порта на S2 F0/18:

Максимальное количество записей MAC-адресов: 2

Тип безопасности: Protect

Aging time: 60 мин.

 - Проверка функции безопасности портов на S2 F0/18.

![](https://github.com/IvShikov/OtusLab/blob/main/LAB10/Lab10_P3S4def.JPG)

### Шаг 5. Реализация безопасности DHCP snooping.
 - На S2 включили DHCP snooping и настроили DHCP snooping во VLAN 10.
 - Настроили магистральные порты на S2 как доверенные порты.
 - Ограничили ненадёжный порт Fa0/18 на S2 пятью DHCP-пакетами в секунду.
 - Проверка DHCP Snooping на S2.

![](https://github.com/IvShikov/OtusLab/blob/main/LAB10/Lab10_P3S5ad.JPG)

 - В командной строке на PC-B освободили, а затем - обновили IP-адрес.

C:\Users\Student> ipconfig /release

C:\Users\Student> ipconfig /renew

![](https://github.com/IvShikov/OtusLab/blob/main/LAB10/Lab10_P3S5e.JPG)

 - Проверили привязку отслеживания DHCP с помощью команды **show ip dhcp snooping binding**.

![](https://github.com/IvShikov/OtusLab/blob/main/LAB10/Lab10_P3S5f.JPG)

### Шаг 6. Реализация PortFast и BPDU Guard.
 - Настроили PortFast на всех портах доступа, которые используются на обоих коммутаторах.
 - Включили защиту BPDU на портах доступа VLAN 10 S1 и S2, подключенных к PC-A и PC-B.
 - Убедились, что защита BPDU и PortFast включены на соответствующих портах.

![]()

### Шаг 7. Проверка наличия сквозного подключения.
Проверили PING-свзяь между всеми устройствами в таблице IP-адресации. В случае сбоя проверки связи может потребоваться отключить брандмауэр на хостах.
##
## **Вопросы для повторения:**
 - С точки зрения безопасности порта на S2, почему нет значения таймера для оставшегося возраста в минутах, когда было сконфигурировано динамическое обучение - sticky?
 - Что касается безопасности порта на S2, если вы загружаете скрипт текущей конфигурации на S2, почему порту 18 на PC-B никогда не получит IP-адрес через DHCP?
 - Что касается безопасности порта, в чем разница между типом абсолютного устаревания и типом устаревание по неактивности?

