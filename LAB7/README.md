# Лабораторная работа № 7. Развёртывание коммутируемой сети с резервными каналами

![](https://github.com/IvShikov/OtusLab/blob/main/LAB7/Lab7_Preamble.PNG)

## Цели:
### Часть 1. Создание сети и настройка основных параметров устройства
### Часть 2. Выбор корневого моста
### Часть 3. Наблюдение за процессом выбора протоколом STP порта, исходя из стоимости портов
### Часть 4. Наблюдение за процессом выбора протоколом STP порта, исходя из приоритета портов
#
## Общие сведения/сценарий
#### Избыточность позволяет увеличить доступность устройств в топологии сети за счёт устранения единой точки отказа. Избыточность в коммутируемой сети обеспечивается посредством использования нескольких коммутаторов или нескольких каналов между коммутаторами. Когда в проекте сети используется физическая избыточность, возможно возникновение петель и дублирование кадров.
#### Протокол spanning-tree (STP) был разработан как механизм предотвращения возникновения петель на 2-м уровне для избыточных каналов коммутируемой сети. Протокол STP обеспечивает наличие только одного логического пути между всеми узлами назначения в сети путем намеренного блокирования резервных путей, которые могли бы вызвать петлю.
#### В этой лабораторной работе команда show spanning-tree используется для наблюдения за процессом выбора протоколом STP корневого моста. Также мы будем наблюдать за процессом выбора портов с учетом стоимости и приоритета.
#### Примечание. Используются коммутаторы Cisco Catalyst 2960s с Cisco IOS версии 15.0(2) (образ lanbasek9). Допускается использование других моделей коммутаторов и других версий Cisco IOS. В зависимости от модели устройства и версии Cisco IOS доступные команды и результаты их выполнения могут отличаться от тех, которые показаны в лабораторных работах. 
#### Примечание. Убедитесь, что все настройки коммутатора удалены и загрузочная конфигурация отсутствует. Если вы не уверены, обратитесь к инструктору.
## Необходимые ресурсы:
### •	3 коммутатора (Cisco 2960 с операционной системой Cisco IOS 15.0(2) (образ lanbasek9) или аналогичная модель),
### •	консольные кабели для настройки устройств Cisco IOS через консольные порты,
### •	кабели Ethernet, расположенные в соответствии с топологией.
#
### Часть 1. Создание сети и настройка основных параметров устройства
В части 1 нам предстоит настроить топологию сети и основные параметры маршрутизаторов.
#### Шаг 1:	Создание сети согласно топологии
Подключили устройства, как показано в топологии, и подсоединили необходимые кабели.
#### Шаг 2:	Выполнение инициализации и перезагрузки коммутаторов
#### Шаг 3:	Настройка базовых параметров каждого коммутатора
##### a.	Отключили поиск DNS.
##### b.	Присвоили имена устройствам в соответствии с топологией.
##### c.	Назначили class в качестве зашифрованного пароля доступа к привилегированному режиму.
##### d.	Назначили cisco в качестве паролей консоли и VTY и активировали вход для консоли и VTY-каналов.
##### e.	Настроили logging synchronous для консольного канала.
##### f.	Настроили баннерное сообщение дня (MOTD) для предупреждения пользователей о запрете несанкционированного доступа.
##### g.	Задали IP-адреса, указанного в таблице адресации для VLAN 1 на всех коммутаторах.
##### h.	Скопировали текущую конфигурацию в файл загрузочной конфигурации.
#### Шаг 4:	Проверка связи
Проверили способности компьютеров обмениваться эхо-запросами.
##### Эхо-запрос от коммутатора S1 на коммутатор S2 выполняется успешно.	
##### Эхо-запрос от коммутатора S1 на коммутатор S3 выполняется успешно.
##### Эхо-запрос от коммутатора S2 на коммутатор S3 выполняется успешно.

![](https://github.com/IvShikov/OtusLab/blob/main/LAB7/Lab7_P1_S4a.JPG)

![](https://github.com/IvShikov/OtusLab/blob/main/LAB7/Lab7_P1_S4b.JPG)

![](https://github.com/IvShikov/OtusLab/blob/main/LAB7/Lab7_P1_S4c.JPG)
#
### Часть 2. Выбор корневого моста
Для каждого экземпляра протокола spanning-tree (коммутируемая сеть LAN или широковещательный домен) существует коммутатор, выделенный в качестве корневого моста. Корневой мост служит точкой привязки для всех расчётов протокола spanning-tree, позволяя определить избыточные пути, которые следует заблокировать.
#
Процесс выбора определяет, какой из коммутаторов станет корневым мостом. Коммутатор с наименьшим значением идентификатора моста (BID) становится корневым мостом. Идентификатор BID состоит из значения приоритета моста, расширенного идентификатора системы и MAC-адреса коммутатора. Значение приоритета может находиться в диапазоне от 0 до 65535 с шагом 4096. По умолчанию используется значение 32768.
#
##### Шаг 1:	Отключили все порты на коммутаторах.

![](https://github.com/IvShikov/OtusLab/blob/main/LAB7/Lab7_P2_S1a.JPG)

![](https://github.com/IvShikov/OtusLab/blob/main/LAB7/Lab7_P2_S1b.JPG)

![](https://github.com/IvShikov/OtusLab/blob/main/LAB7/Lab7_P2_S1c.JPG)

##### Шаг 2:	Настроили подключенные порты в качестве транковых.
##### Шаг 3:	Включили порты F0/2 и F0/4 на всех коммутаторах.
##### Шаг 4:	Отобразили данные протокола spanning-tree.
Ввели команду show spanning-tree на всех трёх коммутаторах. Приоритет идентификатора моста рассчитывается путём сложения значений приоритета и расширенного идентификатора системы. Расширенным идентификатором системы всегда является номер сети VLAN. В примере ниже все три коммутатора имеют равные значения приоритета идентификатора моста (32769 = 32768 + 1, где приоритет по умолчанию = 32768, номер сети VLAN = 1); следовательно, коммутатор с самым низким значением MAC-адреса становится корневым мостом (в примере — S2, у нас - S1).

![](https://github.com/IvShikov/OtusLab/blob/main/LAB7/Lab7_P2_S4_example.PNG)

![](https://github.com/IvShikov/OtusLab/blob/main/LAB7/Lab7_P2_S4_example2.PNG)

![](https://github.com/IvShikov/OtusLab/blob/main/LAB7/Lab7_P2_S1-4a.JPG)

![](https://github.com/IvShikov/OtusLab/blob/main/LAB7/Lab7_P2_S1-4b.JPG)

![](https://github.com/IvShikov/OtusLab/blob/main/LAB7/Lab7_P2_S1-4c.JPG)

###### Примечание. Режим STP по умолчанию на коммутаторе 2960 — протокол STP для каждой сети VLAN (PVST).
В схему ниже записали роль и состояние (Sts) активных портов на каждом коммутаторе в топологии.

![](https://github.com/IvShikov/OtusLab/blob/main/LAB7/Lab7_P2_S4_Scheme%20to%20fulfill.PNG)

С учётом выходных данных, поступающих с коммутаторов, выяснили, что
Коммутатор S1 является корневым мостом. 
Этот коммутатор был выбран протоколом spanning-tree в качестве корневого моста, потому что у него самый низкий bridge ID (значение приоритета и расширенный идентификатор системы (VLAN), и MAC-адрес).
Корневыми портами на коммутаторах являются порты fa04 свитча S3 и fa02 свитча S2.
Назначенными портами на коммутаторе являются порты fa02 и fa04 свитча S1, fa03 свитча S2, fa04 свитча S3.
В качестве альтернативного отображается порт fa02 свитча S3 и он в настоящее время заблокирован.
Протокол spanning-tree выбрал этот порт в качестве невыделенного (заблокированного) порта потому, что?
_______________________________________________________________________________________
_______________________________________________________________________________________
_______________________________________________________________________________________
_______________________________________________________________________________________
#
### Часть 3. Наблюдение за процессом выбора протоколом STP порта, исходя из стоимости портов
Алгоритм протокола spanning-tree (STA) использует корневой мост как точку привязки, после чего определяет, какие порты будут заблокированы, исходя из стоимости пути. Порт с более низкой стоимостью пути является предпочтительным. Если стоимости портов равны, процесс сравнивает BID. Если BID равны, для определения корневого моста используются приоритеты портов. Наиболее низкие значения являются предпочтительными. В части 3 нам предстоит изменить стоимость порта, чтобы определить, какой порт будет заблокирован протоколом spanning-tree.
##### Шаг 1:	Определение коммутатора с заблокированным портом 
При текущей конфигурации только один коммутатор может содержать заблокированный протоколом STP порт. Выполнили команду show spanning-tree на обоих коммутаторах некорневого моста. В примере ниже протокол spanning-tree блокирует порт F0/4 на коммутаторе с самым высоким идентификатором BID (S1).

![](https://github.com/IvShikov/OtusLab/blob/main/LAB7/Lab7_P3_S1.PNG)

##### Шаг 2:	Изменение стоимости порта
Помимо заблокированного порта, единственным активным портом на этом коммутаторе является порт, выделенный в качестве порта корневого моста. Уменьшим стоимость этого порта корневого моста до 18, выполнив команду spanning-tree vlan 1 cost 18 режима конфигурации интерфейса.
#
S1(config)# interface f0/2
S1(config-if)# spanning-tree vlan 1 cost 18
#
##### Шаг 3:	Просмотр изменений протокола spanning-tree.
Повторно выполним команду show spanning-tree на обоих коммутаторах некорневого моста. Ранее заблокированный порт (S1 – F0/4) теперь является назначенным портом и протокол spanning-tree теперь блокирует порт на другом коммутаторе некорневого моста (S3 – F0/4).

![](https://github.com/IvShikov/OtusLab/blob/main/LAB7/Lab7_P3_S3.PNG)
![](https://github.com/IvShikov/OtusLab/blob/main/LAB7/Lab7_P3_S3_2.PNG)

Протокол spanning-tree заменяет ранее заблокированный порт на назначенный порт и блокирует порт, который был назначенным портом на другом коммутаторе потому, что ?
_______________________________________________________________________________________
_______________________________________________________________________________________
##### Шаг 4:	Удаление изменений стоимости порта.
###### a.	Выполнили команду no spanning-tree vlan 1 cost 18 режима конфигурации интерфейса, чтобы удалить запись стоимости, созданную ранее.
S1(config)# interface f0/2
S1(config-if)# no spanning-tree vlan 1 cost 18
###### b.	Повторно выполнили команду show spanning-tree, чтобы подтвердить, что протокол STP сбросил порт на коммутаторе некорневого моста, вернув исходные настройки порта. Протоколу STP требуется примерно 30 секунд, чтобы завершить процесс перевода порта.
#
### Часть 4. Наблюдение за процессом выбора протоколом STP порта, исходя из приоритета портов
Если стоимости портов равны, процесс сравнивает BID. Если BID равны, для определения корневого моста используются приоритеты портов. Значение приоритета по умолчанию — 128. STP объединяет приоритет порта с номером порта, чтобы разорвать связи. Наиболее низкие значения являются предпочтительными. В части 4 нам предстоит активировать избыточные пути до каждого из коммутаторов, чтобы просмотреть, каким образом протокол STP выбирает порт с учётом приоритета портов.
##### a.	Включили порты F0/1 и F0/3 на всех коммутаторах.
##### b.	Подождали 30 секунд, чтобы протокол STP завершил процесс перевода порта, после чего выполнили команду show spanning-tree на коммутаторах некорневого моста. Порт корневого моста переместился на порт с меньшим номером, связанный с коммутатором корневого моста, и заблокировал предыдущий порт корневого моста.

![](https://github.com/IvShikov/OtusLab/blob/main/LAB7/Lab7_P4_b.PNG)

![](https://github.com/IvShikov/OtusLab/blob/main/LAB7/Lab7_P4_b2.PNG)

Протокол STP в качестве порта корневого моста на каждом коммутаторе некорневого моста выбрал порт? _________________________________
Протокол STP выбрал эти порты в качестве портов корневого моста на этих коммутаторах потому, что ?
_______________________________________________________________________________________
_______________________________________________________________________________________
#### Вопросы для повторения:
##### 1.	Чтобы определить выбор порта, протокол STP использует _____первым после выбора корневого моста?
_______________________________________________________________________________________
##### 2.	Если первое значение на двух портах одинаково, протокол STP при выборе порта будет использвать следующим значение____?
_______________________________________________________________________________________
##### 3.	Если оба значения на двух портах равны, следующее значение, которое использует протокол STP при выборе порта, будет____?
_______________________________________________________________________________________

