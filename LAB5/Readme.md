# Лабораторная работа № 5. Доступ к сетевым устройствам по протоколу SSH

![](https://github.com/IvShikov/OtusLab/blob/main/LAB5/Lab5_Preface.PNG)

## Задачи:
### Часть 1. Настройка основных параметров устройства
### Часть 2. Настройка маршрутизатора для доступа по протоколу SSH
### Часть 3. Настройка коммутатора для доступа по протоколу SSH
### Часть 4. Настройка протокола SSH через интерфейс командной строки (CLI) коммутатора
#
## Общие сведения/сценарий

Раньше для удаленной настройки сетевых устройств в основном применялся протокол Telnet. Однако он не обеспечивает шифрование информации, передаваемой между клиентом и сервером, что позволяет анализаторам сетевых пакетов перехватывать пароли и данные конфигурации.
**Secure Shell (SSH)** — это сетевой протокол, устанавливающий безопасное подключение с эмуляцией терминала к маршрутизатору или иному сетевому устройству. Протокол SSH шифрует все сведения, которые поступают по сетевому каналу, и предусматривает аутентификацию удаленного компьютера. Протокол SSH всё больше заменяет Telnet — именно его выбирают сетевые специалисты в качестве средства удаленного входа в систему. SSH чаще всего используется для входа на удаленное устройство и выполнения команд. Но это может также передавать файлы по связанным протоколам SFTP или SCP.
Чтобы протокол SSH мог работать, на сетевых устройствах, взаимодействующих между собой, должна быть настроена поддержка SSH. В этой лабораторной работе необходимо включить SSH-сервер на маршрутизаторе, после чего подключиться к этому маршрутизатору, используя ПК с установленным клиентом SSH. В локальной сети подключение обычно устанавливается с помощью Ethernet и IP.
#
**Примечание**: Маршрутизаторы, используемые в практических лабораторных работах CCNA, - это Cisco 4221 с Cisco IOS XE Release 16.9.4 (образ universalk9). В лабораторных работах используются коммутаторы Cisco Catalyst 2960 с Cisco IOS версии 15.2(2) (образ lanbasek9). Можно использовать другие маршрутизаторы, коммутаторы и версии Cisco IOS. В зависимости от модели устройства и версии Cisco IOS доступные команды и результаты их выполнения могут отличаться от тех, которые показаны в лабораторных работах. Правильные идентификаторы интерфейса см. в сводной таблице по интерфейсам маршрутизаторов в конце лабораторной работы.
#
**Примечание**:  Следует убедиться, что у всех маршрутизаторов и коммутаторов была удалена начальная конфигурация. 
#
## Необходимые ресурсы:
 - 1 маршрутизатор (Cisco 4221 с универсальным образом Cisco IOS XE версии 16.9.4 или аналогичным);
 - 1 коммутатор (Cisco 2960 с ПО Cisco IOS версии 15.2(2) с образом lanbasek9 или аналогичная модель);
 - 1 ПК (под управлением Windows с программой эмуляции терминала, например, Cisco Packet Tracer);
 - консольные кабели для настройки устройств Cisco IOS через консольные порты;
 - кабели Ethernet, расположенные в соответствии с топологией.

## Часть 1. Настройка основных параметров устройств
В части 1 потребуется настроить топологию сети и основные параметры, такие как IP-адреса интерфейсов, доступ к устройствам и пароли на маршрутизаторе.
#
### Шаг 1. Создание сети согласно топологии.
### Шаг 2. Выполнение инициализации и перезагрузки маршрутизатора и коммутатора.
### Шаг 3. Настройка маршрутизатора.
 1. Подключились к маршрутизатору с помощью консоли и активировали привилегированный режим EXEC.
 2. Вошли в режим конфигурации.
 3. Отключили поиск DNS, чтобы предотвратить попытки маршрутизатора неверно преобразовывать введенные команды таким образом, как будто они являются именами узлов.
 4. Назначили **class** в качестве зашифрованного пароля привилегированного режима EXEC.
 5. Назначили **cisco** в качестве пароля консоли и включили вход в систему по паролю.
 6. Назначили **cisco** в качестве пароля VTY и включили вход в систему по паролю.
 7. Зашифровали открытые пароли.
 8. Создали баннер, который предупреждает о запрете несанкционированного доступа.
 9. Настроили и активировали на маршрутизаторе интерфейс G0/0/1, используя информацию, приведенную в таблице адресации.
 10. Сохранили текущую конфигурацию в файл загрузочной конфигурации.

![](https://github.com/IvShikov/OtusLab/blob/main/LAB5/Lab5_P1_S3.JPG)

### Шаг 4. Настройка компьютер PC-A.
 
 - Настроили для PC-A IP-адрес и маску подсети. 
 - Настроили для PC-A шлюз по умолчанию.

![](https://github.com/IvShikov/OtusLab/blob/main/LAB5/Lab5_P1_S4.JPG)

### Шаг 5. Проверка подключения к сети.
Отправили с PC-A команду **ping** на маршрутизатор R1. Эхо-запрос с помощью команды ping проходит.

![](https://github.com/IvShikov/OtusLab/blob/main/LAB5/Lab5_P1_S5.JPG)


## Часть 2. Настройка маршрутизатора для доступа по протоколу SSH
Подключение к сетевым устройствам по протоколу Telnet сопряжено с риском для безопасности, поскольку вся информация передается в виде открытого текста. Протокол SSH шифрует данные сеанса и обеспечивает аутентификацию устройств, поэтому для удаленных подключений рекомендуется использовать именно этот протокол. В части 2 нужно настроить маршрутизатор для приема соединений SSH по линиям VTY.
### Шаг 1. Настройка аутентификации устройств.
При генерации ключа шифрования в качестве его части используются имя устройства и домен. Поэтому эти имена необходимо указать перед вводом команды **crypto key**.
Открыли окно конфигурации
 - Задали имя устройства.
 - Задали домен для устройства.
### Шаг 2. Создание ключа шифрования с указанием его длины.
### Шаг 3. Создание имени пользователя в локальной базе учетных записей.
Настроили имя пользователя, используя **admin** в качестве имени пользователя и **Adm1nP@55** в качестве пароля.
### Шаг 4. Активация протокола SSH на линиях VTY.

 - Активировали протоколы Telnet и SSH на входящих линиях VTY с помощью команды **transport input**.
 - Изменили способ входа в систему таким образом, чтобы использовалась проверка пользователей по локальной базе учетных записей.

![](https://github.com/IvShikov/OtusLab/blob/main/LAB5/Lab5_P2_S1_4.JPG)

### Шаг 5. Сохранение текущей конфигурации в файл загрузочной конфигурации.

### Шаг 6. Установка соединения с маршрутизатором по протоколу SSH.

 - Запустили Cisco Packet Tracer с PC-A.
 - Установили SSH-подключение к R1. Использовали имя пользователя **admin** и пароль **Adm1nP@55**. У нас получилось установить SSH-подключение к R1.
 - Закрыли окно настройки.

![](https://github.com/IvShikov/OtusLab/blob/main/LAB5/Lab5_P2_S6.JPG)


## Часть 3. Настройка коммутатора для доступа по протоколу SSH
В части 3 требуется настроить коммутатор для приёма подключений по протоколу SSH, а затем - установить SSH-подключение с помощью программы Cisco Packet Tracer.
### Шаг 1. Настройка основных параметров коммутатора.
Открыли окно конфигурации
 1. Подключились к коммутатору с помощью консольного подключения и активировали привилегированный режим EXEC.
 2. Вошли в режим конфигурации.
 3. Отключили поиск DNS, чтобы предотвратить попытки маршрутизатора неверно преобразовывать введенные команды таким образом, как будто они являются именами узлов.
 4. Назначили **class** в качестве зашифрованного пароля привилегированного режима EXEC.
 5. Назначили **cisco** в качестве пароля консоли и включили вход в систему по паролю.
 6. Назначили **cisco** в качестве пароля VTY и включили вход в систему по паролю.
 7. Зашифровали открытые пароли.
 8. Создали баннер, который предупреждает о запрете несанкционированного доступа.
 9. Настроили и активировали на коммутаторе интерфейс VLAN 1, используя информацию, приведенную в таблице адресации.
 10. Сохранили текущую конфигурацию в файл загрузочной конфигурации.

![](https://github.com/IvShikov/OtusLab/blob/main/LAB5/Lab5_P3_S1.JPG)

### Шаг 2. Настройка коммутатора для соединения по протоколу SSH.
Для настройки протокола SSH на коммутаторе использовали те же команды, которые применялись для аналогичной настройки маршрутизатора в части 2.

 1. Настроили имя устройства, как указано в таблице адресации.
 2. Задали домен для устройства.
 3. Создали ключ шифрования с указанием его длины.
 4. Создали имя пользователя в локальной базе учетных записей.
 5. Активировали протоколы Telnet и SSH на линиях VTY.
 6. Изменили способ входа в систему таким образом, чтобы использовалась проверка пользователей по локальной базе учетных записей.

![](https://github.com/IvShikov/OtusLab/blob/main/LAB5/Lab5_P3_S2.JPG)


### Шаг 3. Установка соединения с коммутатором по протоколу SSH.
Запустили программу Cisco Packet Tracer на PC-A, затем - установили подключение по протоколу SSH к интерфейсу SVI коммутатора S1.



#### Вопрос: Удалось ли вам установить SSH-соединение с коммутатором?


## Часть 4. Настройка протокола SSH с использованием интерфейса командной строки (CLI) коммутатора
Клиент SSH встроен в операционную систему Cisco IOS и может запускаться из интерфейса командной строки. В части 4 предстоит установить соединение с маршрутизатором по протоколу SSH, используя интерфейс командной строки коммутатора.
### Шаг 1. Просмотр доступных параметров для клиента SSH в Cisco IOS.
Используем вопросительный знак (**?**), чтобы отобразить варианты параметров для команды **ssh**.
#### S1# **ssh?**
#### -c Select encryption algorithm
#### -l Log in using this user name
#### -m Select HMAC algorithm
#### -o Specify options
#### -p Connect to this port
#### -v Specify SSH Protocol Version
#### -vrf Specify vrf name
#### WORD IP-адрес или имя хоста удаленной системы

### Шаг 2. Установка с коммутатора S1 соединения с маршрутизатором R1 по протоколу SSH.

 1. Чтобы подключиться к маршрутизатору R1 по протоколу SSH, ввели команду **–l admin**. Это позволит нам войти в систему под именем **admin**. При появлении приглашения ввели в качестве пароля **Adm1nP@55**

#### S1# **ssh -l admin 192.168.1.1**
#### Password:
#### Authorized Users Only!
#### R1>

 2. Чтобы вернуться к коммутатору S1, не закрывая сеанс SSH с маршрутизатором R1, нажали комбинацию клавиш **Ctrl**+**Shift**+**6**. Отпустили клавиши **Ctrl**+**Shift**+**6** и нажали **x**. Отображается приглашение привилегированного режима EXEC коммутатора.
#### R1>
#### S1#


 3. Чтобы вернуться к сеансу SSH на R1, нажали клавишу Enter в пустой строке интерфейса командной строки. Чтобы увидеть окно командной строки маршрутизатора, нажали клавишу Enter ещё раз.

#### S1#
#### [Resuming connection 1 to 192.168.1.1 ... ]
#### R1>

 4. Чтобы завершить сеанс SSH на маршрутизаторе R1, ввели в командной строке маршрутизатора команду **exit**.

#### R1# **exit**
#### [Connection to 192.168.1.1 closed by foreign host]
#### S1#

#### При использовании интерфейса командной строки на свитче 2960 с версией IOS 15.0 (2) поддерживаются  версии V1 и V2 протокола SSH 

![](https://github.com/IvShikov/OtusLab/blob/main/LAB5/Lab5_P4_SSH_Versions.JPG)

Закрыли окно настройки.

# Вопрос для повторения
Для того, чтобы предоставить доступ к сетевому устройству нескольким пользователям, у каждого из которых есть собственное имя пользователя, нужно добавить имя и пароль каждого пользователя в локальную базу данных при помощи команды **username**. 

![](https://github.com/IvShikov/OtusLab/blob/main/LAB5/Lab5_General_table.PNG)

**Примечание**. Чтобы определить конфигурацию маршрутизатора, можно посмотреть на интерфейсы и установить тип маршрутизатора и количество его интерфейсов. Перечислить все комбинации конфигураций для каждого класса маршрутизаторов невозможно. Эта таблица содержит идентификаторы для возможных комбинаций интерфейсов Ethernet и последовательных интерфейсов на устройстве. Другие типы интерфейсов в таблице не представлены, хотя они могут присутствовать в данном конкретном маршрутизаторе. В качестве примера можно привести интерфейс ISDN BRI. Строка в скобках — это официальное сокращение, которое можно использовать в командах Cisco IOS для обозначения интерфейса.
