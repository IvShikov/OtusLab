# Лабораторная работа №8. Настройка DHCPv6

![](https://github.com/IvShikov/OtusLab/blob/main/LAB8/Lab8_Topology.JPG)

# Задачи:
## Часть 1. Создание сети и настройка основных параметров устройства
## Часть 2. Проверка назначения адреса SLAAC от R1
## Часть 3. Настройка и проверка сервера DHCPv6 без гражданства на R1
## Часть 4. Настройка и проверка состояния DHCPv6 сервера на R1
## Часть 5. Настройка и проверка DHCPv6 Relay на R2.
# Общие сведения и сценарий:
Динамическое назначение глобальных индивидуальных IPv6-адресов можно настроить тремя способами:
 - Автоматическая конфигурация адреса без сохранения состояния (Stateless Address
Autoconfiguration, SLAAC)
 - DHCPv6 без отслеживания состояния
 - Адресация DHCPv6 с учётом состояний

При использовании SLACC для назначения адресов IPv6 хостам сервер DHCPv6 не используется. Поскольку DHCPv6 сервер не используется при реализации SLACC, хосты не могут получать дополнительную важную сетевую информацию, включая адрес сервера доменных имен (DNS), а также имя домена.
При использовании Stateless DHCPv6 для назначения адресов IPv6 хосту сервер DHCPv6 используется для назначения дополнительной важной информации о сети, однако адрес IPv6 назначается с помощью SLACC.
При использовании DHCPv6 с отслеживанием состояния, сервер DHCP назначает всю информацию, включая IPv6-адрес узла.
Определение способа получения динамической IPv6-адресации зависит от установленных значений флагов, содержащихся в объявлениях маршрутизатора (сообщениях RA).
В предложенном сценарии размеры компании увеличились, и сетевые администраторы больше не имеют возможности назначать IP-адреса для устройств вручную. Наша задача - настроить маршрутизатор R2 для назначения адресов IPv6 в двух разных подсетях, подключенных к маршрутизатору R1.

**Примечание.** Маршрутизаторы, используемые в практических лабораторных работах CCNA, - это Cisco 4221 с Cisco IOS XE Release 16.9.4 (образ universalk9). В лабораторных работах используются коммутаторы Cisco Catalyst 2960 с Cisco IOS версии 15.2(2) (образ lanbasek9). Можно использовать другие маршрутизаторы, коммутаторы и версии Cisco IOS. В зависимости от модели устройства и версии Cisco IOS доступные команды и результаты их выполнения могут отличаться от тех, которые показаны в лабораторных работах. Правильные идентификаторы интерфейса указаны в сводной таблице по интерфейсам маршрутизаторов в конце лабораторной работы.

**Примечание.** Следует убедиться, что у всех маршрутизаторов и коммутаторов была удалена начальная конфигурация. 

# Необходимые ресурсы:

 - 2 маршрутизатора (Cisco 4221 с универсальным образом Cisco IOS XE версии 16.9.4 или аналогичным)
 - 2 коммутатора (Cisco 2960 с образом lanbasek9 Cisco IOS версии 15.2 (2) или аналогичным) - опционально
 - 2 ПК (ОС Windows с программой эмуляции терминалов, такой как Cisco Packet Tracer)
 - Консольные кабели для настройки устройств Cisco IOS через консольные порты.
 - Кабели Ethernet, расположенные в соответствии с топологией
##

## Часть 1. Создание сети и настройка основных параметров устройства
В первой части лабораторной работы нам предстоит создать топологию сети и настроить базовые параметры для узлов ПК и коммутаторов.
### Шаг 1. Создание сети согласно топологии.
Подключение устройств, как показано в топологии, и подсоединение необходимых кабелей.
### Шаг 2. Настройка базовых параметров каждого коммутатора (необязательно).
 - Присвоение коммутатору имени устройства.
 - Отключение поиска DNS, чтобы предотвратить попытки маршрутизатора неверно преобразовывать введённые команды таким образом, как будто они являются именами узлов. 
 - Назначение **class** в качестве зашифрованного пароля привилегированного режима EXEC.
 - Назначение **cisco** в качестве пароля консоли и включите вход в систему по паролю.
 - Назначение **cisco** в качестве пароля VTY и включение входа в систему по паролю.
 - Шифрование открытых паролей.
 - Создание баннера с предупреждением о запрете несанкционированного доступа к устройству.
 - Отключение всех неиспользуемых портов.
 - Сохранение текущей конфигурации в файл загрузочной конфигурации.
### Шаг 3. Произведение базовой настройки маршрутизаторов.
 - Назначение маршрутизатору имени устройства.
 - Отключение поиска DNS, чтобы предотвратить попытки маршрутизатора неверно преобразовывать введённые команды таким образом, как будто они являются именами узлов. 
 - Назначение **class** в качестве зашифрованного пароля привилегированного режима EXEC.
 - Назначение **cisco** в качестве пароля консоли и включение входа в систему по паролю.
 - Назначение **cisco** в качестве пароля VTY и включение входа в систему по паролю.
 - Шифрование открытых паролей.
 - Создание баннера с предупреждением о запрете несанкционированного доступа к устройству.
 - Активация IPv6-маршрутизации
 - Сохранение текущей конфигурации в файл загрузочной конфигурации.
### Шаг 4. Настройка интерфейсов и маршрутизации для обоих маршрутизаторов.
 - Настройка интерфейсов G0/0/0 и G0/1 на R1 и R2 с адресами IPv6, указанными в таблице выше.
 - Настройка маршрута по умолчанию на каждом маршрутизаторе, который указывает на IP-адрес G0/0/0 на другом маршрутизаторе.
 - Проверка того, что маршрутизация работает с помощью пинга адреса G0/0/1 R2 из R1.
 - Сохранение текущей конфигурации в файл загрузочной конфигурации.

![](https://github.com/IvShikov/OtusLab/blob/main/LAB8/Lab8_P1_R1.JPG)

![](https://github.com/IvShikov/OtusLab/blob/main/LAB8/Lab8_P1_R2.JPG)

## Часть 2. Проверка назначения адреса SLAAC от R1
В части 2 мы убедимся, что узел PC-A получает адрес IPv6 с помощью метода SLAAC.
Включим PC-A и убедимся, что сетевой адаптер настроен для автоматической настройки IPv6.
Через несколько минут результаты команды ipconfig должны показать, что PC-A присвоил себе адрес из сети 2001:db8:1::/64.

![](https://github.com/IvShikov/OtusLab/blob/main/LAB8/Lab8_P2_PCAcmd.JPG)

Часть адреса с идентификатором хоста основана на физическом адресе компьютера (МАС-адресе интерфейса). 

## Часть 3. Настройка и проверка сервера DHCPv6 на R1
В части 3 выполняется настройка и проверка состояния DHCP-сервера на R1. Цель состоит в том, чтобы предоставить PC-A информацию о DNS-сервере и домене.

### Шаг 1. Более подробное изучение конфигурации PC-A.
  - Выполнили команду **ipconfig /all** на PC-A и просмотрели результат.

![](https://github.com/IvShikov/OtusLab/blob/main/LAB8/Lab8_P3_S1_PCAipconf.JPG)

 - Обратили внимание, что основной DNS-суффикс отсутствует. Также обратили внимание на то, что предоставленные адреса DNS-сервера являются адресами «локального сайта anycast», а не одноадресными адресами, как ожидалось.
### Шаг 2. Настройка R1 для предоставления DHCPv6 без состояния для PC-A.
 - Создали пул DHCP IPv6 на R1 с именем R1-STATELESS. В составе этого пула назначили адрес DNS-сервера как 2001:db8:acad: :1, а имя домена — как stateless.com.
   
R1(config)# ipv6 dhcp pool R1-STATELESS

R1(config-dhcp)# dns-server 2001:db8:acad::254

R1(config-dhcp)# domain-name STATELESS.com

 - Настроили интерфейс G0/0/1 на R1, чтобы предоставить флаг конфигурации OTHER для локальной сети R1 и указали только что созданный пул DHCP в качестве ресурса DHCP для этого интерфейса.

R1(config)# interface g0/0/1

R1(config-if)# ipv6 nd other-config-flag

R1(config-if)# ipv6 dhcp server R1-STATELESS

 - Сохранили текущую конфигурацию в файл загрузочной конфигурации.
 - Перезапустили PC-A.
 - Проверили вывод ipconfig /all и обратили внимание на изменения.
 - Протестировали подключение с помощью пинга IP-адреса интерфейса G0/1 R2.

![](https://github.com/IvShikov/OtusLab/blob/main/LAB8/Lab8_P3_PCAafterDNS.JPG)

## Часть 4. Настройка сервера DHCPv6 с сохранением состояния на R1
В части 4 настраивается R1 для ответа на запросы DHCPv6 от локальной сети на R2.
 - Создали пул DHCPv6 на R1 для сети 2001:db8:acad:3:aaa::/80. Это предоставит адреса локальной сети, подключенной к интерфейсу G0/0/1 на R2.
 - В составе пула задали DNS-сервер 2001:db8:acad: :254 и задали доменное имя STATEFUL.com.
 - Назначили только что созданный пул DHCPv6 интерфейсу g0/0/0 на R1.

![](https://github.com/IvShikov/OtusLab/blob/main/LAB8/Lab8_P4.JPG)

## Часть 5. Настройка и проверка ретрансляции DHCPv6 на R2
В части 5 необходимо настроить и проверить ретрансляцию DHCPv6 на R2, позволяя PC-B получать адрес IPv6.
### Шаг 1. Включение PC-B и проверка адреса SLAAC, который он генерирует.

![](https://github.com/IvShikov/OtusLab/blob/main/LAB8/Lab8_P5_S1_PCB.JPG)

Обратили внимание на вывод, что используется префикс 2001:db8:acad:3::
### Шаг 2. Настройка R2 в качестве агента DHCP-ретрансляции для локальной сети на G0/0/1.

 - Настроили команду **ipv6 dhcp relay** на интерфейсе R2 G0/0/1, указав адрес назначения интерфейса G0/0/0 на R1. Также настроили команду **managed-config-flag** .
 - Сохранили конфигурацию.

![](https://github.com/IvShikov/OtusLab/blob/main/LAB8/Lab8_P5_S2_R2dhcp.JPG)

### Шаг 3. Попытка получить адрес IPv6 из DHCPv6 на PC-B.
 - Перезапустили PC-B.
 - Открыли командную строку на PC-B и выполните команду ipconfig /all и проверили выходные данные, чтобы увидеть результаты операции ретрансляции DHCPv6.

![](https://github.com/IvShikov/OtusLab/blob/main/LAB8/Lab8_P5_S3_PCBipconf.JPG)

 - Проверили подключение с помощью пинга IP-адреса интерфейса R0 G0/0/1.

![](https://github.com/IvShikov/OtusLab/blob/main/LAB8/Lab8_P5_PCBpings.JPG)
